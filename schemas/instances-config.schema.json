{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "BusinessMap MCP Multi-Instance Configuration",
  "description": "Configuration schema for managing multiple BusinessMap instances in a single MCP server",
  "type": "object",
  "required": ["version", "default_instance", "instances"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$",
      "description": "Configuration schema version (e.g., '1.0')",
      "examples": ["1.0", "1.1", "2.0"]
    },
    "default_instance": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_-]+$",
      "description": "Default instance ID to use when not explicitly specified in tool calls",
      "examples": ["production", "main", "primary"]
    },
    "instances": {
      "type": "object",
      "minProperties": 1,
      "description": "Map of instance ID to instance configuration",
      "additionalProperties": {
        "type": "object",
        "required": ["name", "api_url", "api_token_env"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100,
            "description": "Human-readable instance name",
            "examples": ["Production", "Staging", "Development"]
          },
          "description": {
            "type": "string",
            "maxLength": 500,
            "description": "Optional detailed description of the instance",
            "examples": [
              "Production environment for customer-facing operations",
              "Staging environment for QA testing"
            ]
          },
          "api_url": {
            "type": "string",
            "format": "uri",
            "pattern": "^https?://[^\\s/$.?#].[^\\s]*$",
            "description": "BusinessMap API URL (must be unique across instances)",
            "examples": [
              "https://company.kanbanize.com/api/v2",
              "https://company-staging.kanbanize.com/api/v2"
            ]
          },
          "api_token_env": {
            "type": "string",
            "pattern": "^[A-Z_][A-Z0-9_]*$",
            "description": "Environment variable name containing the API token",
            "examples": [
              "BUSINESSMAP_API_TOKEN_PROD",
              "BUSINESSMAP_API_TOKEN_STAGING"
            ]
          },
          "default_workspace_id": {
            "type": "integer",
            "minimum": 1,
            "description": "Default workspace ID for this instance (optional)",
            "examples": [123, 456, 789]
          },
          "read_only_mode": {
            "type": "boolean",
            "default": false,
            "description": "Enable read-only mode (blocks create/update/delete operations)",
            "examples": [false, true]
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^[a-zA-Z0-9_-]+$",
              "minLength": 1,
              "maxLength": 50
            },
            "uniqueItems": true,
            "maxItems": 20,
            "description": "Optional tags for filtering/grouping instances",
            "examples": [
              ["prod", "primary"],
              ["staging", "testing"],
              ["dev", "local"]
            ]
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
