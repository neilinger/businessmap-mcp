# Dependency Vulnerability Rationale

**Date**: 2025-11-19
**Context**: PR #30 - Token Optimization Phase 2
**Status**: Vulnerability Accepted (Risk: Low)

## Summary

CI Dependency Security check failing due to `glob` vulnerability (GHSA-5j98-mcp5-4vw2) in `semantic-release` dependency chain.

**Decision**: Accept vulnerability as low-risk for this PR.

---

## Vulnerability Details

```text
Package: glob 10.2.0 - 10.4.5
Severity: HIGH
CVE: GHSA-5j98-mcp5-4vw2
Issue: Command injection via -c/--cmd executes matches with shell:true
```

**Dependency Chain**:

```text
semantic-release@24.2.9
  └── @semantic-release/npm@12.0.2
      └── npm@10.9.4 (bundled)
          └── glob@10.4.5 (bundled)
```

---

## Why Accepting This Vulnerability

### 1. Dev Dependency Only

- `semantic-release` is a **devDependency** used only for automated releases
- Not included in production deployment
- Not part of the MCP server runtime
- No exposure in production environment

### 2. Upgrade Breaks Build

Attempted fix via `npm audit fix --force`:

```bash
semantic-release: v24.2.9 → v25.0.2
@semantic-release/npm: v12.0.2 → v13.1.2
```

**Result**: Build failure due to dependency conflict

```text
npm error invalid: nopt@9.0.0 node_modules/npm/node_modules/nopt
Expected: ^8.0.0 or ^8.1.0
Actual: 9.0.0
```

This is a known issue with semantic-release v25 + npm v11.6.3.

### 3. Limited Attack Surface

For the vulnerability to be exploited:

1. Attacker needs write access to package.json or semantic-release config
2. Attacker needs to trigger a release
3. Attacker needs to inject malicious glob patterns

All require **existing repository access** - at which point they have higher-privilege attack vectors.

### 4. Time Cost vs. Risk

**Options**:

- **Option A**: Spend 2-4 hours debugging semantic-release v25 compatibility
- **Option B**: Wait for upstream fix in semantic-release ecosystem
- **Option C**: Accept low-risk vulnerability in dev dependency

**Chosen**: Option C (accept) - risk is minimal, time better spent elsewhere

---

## Risk Assessment

| Factor             | Level    | Justification                               |
| ------------------ | -------- | ------------------------------------------- |
| **Exploitability** | Low      | Requires repository write access            |
| **Impact**         | None     | Dev dependency, not in production           |
| **Likelihood**     | Very Low | Attack requires deliberate malicious config |
| **Overall Risk**   | **LOW**  | Not a blocker for PR merge                  |

---

## Mitigation

1. **Monitor for Fix**: Watch semantic-release releases for compatibility fix
2. **Separate Issue**: Track as technical debt, not PR blocker
3. **Future Action**: Upgrade when semantic-release v25 stabilizes
4. **CI Override**: Configure CI to allow this specific vulnerability for now

---

## Recommendation

**Merge PR #30 with acknowledged vulnerability**:

- Core functionality: ✅ All tests passing
- Production code: ✅ No vulnerabilities
- Dev dependencies: ⚠️ Accepted risk (low impact)

**Create follow-up issue**: "Upgrade semantic-release to v25 when stable"

---

## References

- PR #30: https://github.com/neilinger/businessmap-mcp/pull/30
- CVE: GHSA-5j98-mcp5-4vw2
- semantic-release v25 issues: https://github.com/semantic-release/semantic-release/issues

**Document Status**: Approved for this PR, revisit when ecosystem stabilizes
