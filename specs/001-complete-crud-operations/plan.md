# Implementation Plan: Complete CRUD Operations

**Branch**: `001-complete-crud-operations` | **Date**: 2025-10-24 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/001-complete-crud-operations/spec.md`

**Note**: This plan is generated by the `/speckit.plan` command following research phase completion.

## Summary

Implement complete CRUD operations for BusinessMap MCP server by exposing 22 new MCP tools (11 new single-resource operations + 6 new bulk operations + 5 quick-win exposures) across Comments, Subtasks, Custom Fields, Workspaces, Boards, and Cards. Research revealed better-than-expected API coverage (~82% vs 65-75% estimated), with full CRUD support for Comments, Subtasks, and Custom Field definitions. Includes minimal viable rate limit handling strategy (axios-retry + header monitoring).

**Key Findings**:
- 12 new operations discovered as fully supported (previously uncertain)
- Demo API available at `https://demo.kanbanize.com/api/v2`
- Rate limits: 600/hr, 30/min (default)
- Workflows/Columns creation not supported (UI-only)

## Technical Context

**Language/Version**: TypeScript 5.x with Node.js 18+
**Primary Dependencies**: Axios (HTTP client), MCP SDK (@modelcontextprotocol/sdk), Zod (schema validation), axios-retry (rate limit handling)
**Storage**: N/A (API client, no local persistence)
**Testing**: Jest + axios-mock-adapter (unit), Integration tests against demo API
**Target Platform**: Node.js server (MCP protocol)
**Project Type**: single (MCP server implementation)
**Performance Goals**: <2s single operations, <10s bulk operations (≤50 resources), API rate limit compliance (30/min, 600/hr)
**Constraints**: API rate limits (600/hr, 30/min default), exponential backoff on RL02 errors, no batch endpoints available
**Scale/Scope**: 17 new MCP tools, 12 new client methods, 6 new contract files, ~3-4 days implementation

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Core Principles Compliance

| Principle | Status | Evidence |
|-----------|--------|----------|
| **I. API-First Integration** | ✅ PASS | All operations validated against OpenAPI v2 spec. Operations not supported (workflows, columns) explicitly documented with clear error messages. |
| **II. Read-Only Mode Safety** | ✅ PASS | All new write operations (update, delete) will respect existing `BUSINESSMAP_READ_ONLY_MODE` environment variable enforced at tool registration level. |
| **III. Comprehensive CRUD Coverage** | ✅ PASS | Achieves ~80% overall coverage (up from 50%). Partial support clearly documented (outcomes: read-only, workflows: read-only, columns: read-only). |
| **IV. Explicit Confirmation for Destructive Operations** | ✅ PASS | Delete operations with dependencies (workspace→boards, card→children) require confirmation. Simple deletes execute immediately per constitution. |
| **V. Type Safety and Validation** | ✅ PASS | All operations use Zod schemas. Invalid inputs return actionable error messages at MCP protocol boundary. |

### Development Workflow Compliance

| Requirement | Status | Evidence |
|-------------|--------|----------|
| **Specification-Driven Development** | ✅ PASS | Feature began with spec.md → clarification → planning. This plan.md created via /speckit.plan command. |
| **API Research Before Implementation** | ✅ PASS | Phase 0 research completed (research.md). Operations verified via OpenAPI spec analysis before marking as MUST requirements. |
| **Incremental Tool Exposure** | ✅ PASS | Phase 2 prioritizes exposing 5 existing client methods. Phase 1 implements 12 new operations with Zod schemas + error handling. |

### Quality Standards Compliance

| Standard | Status | Evidence |
|----------|--------|----------|
| **Error Handling Excellence** | ✅ PASS | All operations return meaningful errors: (1) specific cause, (2) transient vs permanent, (3) remediation steps. Rate limit errors (RL02) include retry-after guidance. |
| **Performance Targets** | ✅ PASS | Single operations: <2s, Bulk operations: <10s for ≤50 resources, Dependency analysis: <500ms overhead. axios-retry configured for rate limit compliance. |
| **Documentation Standards** | ✅ PASS | Tool descriptions include: supported operations with limitations, required/optional parameters, examples (in contracts/), links to OpenAPI docs. |

### Post-Design Re-check (After Phase 1)

✅ **All constitutional gates remain PASS after research + design phase.**

**Justification**: Research phase discovered better API support than expected, improving coverage without compromising constitutional principles. Rate limit handling uses minimal viable approach (axios-retry) per YAGNI principle. No violations introduced.

## Project Structure

### Documentation (this feature)

```text
specs/001-complete-crud-operations/
├── spec.md                              # Feature specification (user input)
├── plan.md                              # This file (Phase 0-1 output)
├── research.md                          # API research findings (Phase 0)
├── data-model.md                        # Entity models & relationships (Phase 1)
├── quickstart.md                        # Implementation guide (Phase 1)
├── contracts/                           # OpenAPI 3.0 contracts (Phase 1)
│   ├── comments-api.yaml
│   ├── subtasks-api.yaml
│   ├── custom-fields-api.yaml
│   ├── workspaces-api.yaml
│   ├── boards-api.yaml
│   ├── cards-api.yaml
│   ├── README.md
│   ├── CONTRACTS_SUMMARY.md
│   ├── INDEX.md
│   ├── CONFIRMATION_EXAMPLES.md
│   └── validate-all.sh
└── tasks.md                             # Implementation tasks (/speckit.tasks - NOT YET CREATED)
```

### Source Code (repository root)

**Structure**: Single project (MCP server)

```text
src/
├── index.ts                             # MCP server entry point
├── clients/                             # API client layer
│   ├── base-client.ts                   # Rate limit handling (MODIFY)
│   ├── workspace-client.ts              # Workspace operations (existing)
│   ├── board-client.ts                  # Board operations (existing)
│   ├── card-client.ts                   # Card operations (MODIFY: add comment/subtask update/delete)
│   ├── custom-field-client.ts           # Custom field operations (NEW)
│   └── index.ts
├── schemas/                             # Zod validation schemas
│   ├── workspace-schemas.ts             # Workspace schemas (MODIFY: add update/delete)
│   ├── board-schemas.ts                 # Board schemas (MODIFY: add update/delete)
│   ├── card-schemas.ts                  # Card schemas (MODIFY: add delete)
│   ├── comment-schemas.ts               # Comment schemas (MODIFY: add update/delete)
│   ├── subtask-schemas.ts               # Subtask schemas (MODIFY: add update/delete)
│   ├── custom-field-schemas.ts          # Custom field schemas (NEW)
│   └── index.ts
├── tools/                               # MCP tool definitions
│   ├── workspace-tools.ts               # Workspace tools (MODIFY: add update/delete)
│   ├── board-tools.ts                   # Board tools (MODIFY: add update/delete)
│   ├── card-tools.ts                    # Card tools (MODIFY: add delete)
│   ├── comment-tools.ts                 # Comment tools (MODIFY: add update/delete)
│   ├── subtask-tools.ts                 # Subtask tools (MODIFY: add update/delete)
│   ├── custom-field-tools.ts            # Custom field tools (NEW)
│   └── index.ts
└── types/                               # TypeScript interfaces
    └── index.ts

test/
├── unit/                                # Unit tests with mocks
│   ├── clients/                         # Client method tests
│   │   ├── card-client.test.ts          # Test comment/subtask CRUD
│   │   └── custom-field-client.test.ts  # Test custom field CRUD (NEW)
│   └── schemas/                         # Schema validation tests
│       └── custom-field-schemas.test.ts (NEW)
└── integration/                         # Integration tests (demo API)
    ├── crud-operations.test.ts          # Full lifecycle tests (NEW)
    └── mcp-tools.test.ts                # MCP tool integration (NEW)

dist/                                    # Compiled output
└── index.js                             # Built MCP server

.mcp.json                                # MCP server configuration (MODIFIED: added demo instance)
package.json                             # Dependencies (ADD: axios-retry)
tsconfig.json                            # TypeScript config
```

**Structure Decision**: Using existing single-project MCP server structure. All new operations follow established patterns:
1. Client layer: HTTP operations against BusinessMap API
2. Schema layer: Zod validation for MCP tool inputs
3. Tool layer: MCP protocol handlers
4. Test layer: Unit (mocked) + Integration (demo API)

**New Files**:
- `src/clients/custom-field-client.ts`
- `src/schemas/custom-field-schemas.ts`
- `src/tools/custom-field-tools.ts`
- `test/unit/clients/custom-field-client.test.ts`
- `test/unit/schemas/custom-field-schemas.test.ts`
- `test/integration/crud-operations.test.ts`
- `test/integration/mcp-tools.test.ts`

**Modified Files**:
- `src/clients/base-client.ts` (add rate limit handling)
- `src/clients/card-client.ts` (add comment/subtask update/delete)
- `src/schemas/*-schemas.ts` (add update/delete schemas)
- `src/tools/*-tools.ts` (add update/delete tools)
- `src/index.ts` (register new tools)
- `.mcp.json` (add demo configuration)
- `package.json` (add axios-retry dependency)

## Complexity Tracking

**No constitutional violations detected.** All design decisions align with constitutional principles.

Rate limit handling intentionally uses minimal viable approach (axios-retry + header monitoring) per YAGNI principle, avoiding premature optimization until load data justifies more complex queue-based solutions.

---

## References

### Primary Sources

1. **BusinessMap OpenAPI v2 Specification** (Official API Source)
   - Interactive Docs: https://demo.kanbanize.com/openapi
   - JSON Schema: https://demo.kanbanize.com/openapi/json
   - Purpose: API capability verification, endpoint validation during implementation

2. **Feature Specification**: [spec.md](spec.md)
   - User requirements, acceptance criteria, success metrics

3. **Research Findings**: [research.md](research.md)
   - API verification results, rate limit analysis, operation capabilities

4. **Data Model**: [data-model.md](data-model.md)
   - Entity relationships, validation rules, state machines

5. **API Contracts**: [contracts/](contracts/)
   - OpenAPI 3.0 specifications for 17 new operations

6. **Implementation Guide**: [quickstart.md](quickstart.md)
   - Step-by-step developer guide with code examples

### Supporting Documentation

- **Constitution**: `.specify/memory/constitution.md` - Governance principles
- **Demo API Configuration**: `.mcp.json` (businessmap-demo instance)
- **MCP SDK**: https://github.com/modelcontextprotocol/typescript-sdk
